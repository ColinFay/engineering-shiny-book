<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Appendix A - Use Case: Building an App from Start to Finish | Engineering Production-Grade Shiny Apps</title>
<meta name="author" content="Colin Fay">
<meta name="author" content="Sébastien Rochette">
<meta name="author" content="Vincent Guyader">
<meta name="author" content="Cervan Girard">
<meta name="description" content="This chapter aims at exemplifying the workflow developed in this book using a “real-life” example. In this appendix, we will be building a {shiny} application from start to finish. We’ve chosen to...">
<meta name="generator" content="bookdown 0.33 with bs4_book()">
<meta property="og:title" content="Appendix A - Use Case: Building an App from Start to Finish | Engineering Production-Grade Shiny Apps">
<meta property="og:type" content="book">
<meta property="og:image" content="https://raw.githubusercontent.com/ThinkR-open/engineering-shiny-book/master/img/engineering-shiny.jpg">
<meta property="og:description" content="This chapter aims at exemplifying the workflow developed in this book using a “real-life” example. In this appendix, we will be building a {shiny} application from start to finish. We’ve chosen to...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Appendix A - Use Case: Building an App from Start to Finish | Engineering Production-Grade Shiny Apps">
<meta name="twitter:description" content="This chapter aims at exemplifying the workflow developed in this book using a “real-life” example. In this appendix, we will be building a {shiny} application from start to finish. We’ve chosen to...">
<meta name="twitter:image" content="https://raw.githubusercontent.com/ThinkR-open/engineering-shiny-book/master/img/engineering-shiny.jpg">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap/bootstrap.bundle.min.js"></script><script src="libs/bs3compat/transition.js"></script><script src="libs/bs3compat/tabs.js"></script><script src="libs/bs3compat/bs3compat.js"></script><link href="libs/bs4_book/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book/bs4_book.js"></script><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-149994171-1"></script><script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-149994171-1');
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<style type="text/css">
    /* Used with Pandoc 2.11+ new --citeproc when CSL is used */
    div.csl-bib-body { }
    div.csl-entry {
      clear: both;
          margin-bottom: 0em;
        }
    .hanging div.csl-entry {
      margin-left:2em;
      text-indent:-2em;
    }
    div.csl-left-margin {
      min-width:2em;
      float:left;
    }
    div.csl-right-inline {
      margin-left:2em;
      padding-left:1em;
    }
    div.csl-indent {
      margin-left: 2em;
    }
  </style>
<link rel="stylesheet" href="css/style.css">
<link rel="stylesheet" href="css/thinkr.css">
<link rel="stylesheet" href="css/style_gitbook.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Engineering Production-Grade Shiny Apps</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Introduction</a></li>
<li><a class="" href="foreword.html">Foreword</a></li>
<li><a class="" href="application-presentation.html">Application presentation</a></li>
<li class="book-part">Building Successful {shiny} Apps</li>
<li><a class="" href="successful-shiny-app.html"><span class="header-section-number">1</span> About Successful {shiny} Apps</a></li>
<li><a class="" href="planning-ahead.html"><span class="header-section-number">2</span> Planning Ahead</a></li>
<li><a class="" href="structuring-project.html"><span class="header-section-number">3</span> Structuring Your Project</a></li>
<li><a class="" href="golem.html"><span class="header-section-number">4</span> Introduction to {golem}</a></li>
<li><a class="" href="workflow.html"><span class="header-section-number">5</span> The Workflow</a></li>
<li class="book-part">Step 1: Design</li>
<li><a class="" href="ux-matters.html"><span class="header-section-number">6</span> UX Matters</a></li>
<li><a class="" href="dont-rush-into-coding.html"><span class="header-section-number">7</span> Don’t Rush into Coding</a></li>
<li class="book-part">Step 2: Prototype</li>
<li><a class="" href="setting-up-for-success.html"><span class="header-section-number">8</span> Setting up for Success with {golem}</a></li>
<li><a class="" href="building-ispum-app.html"><span class="header-section-number">9</span> Building an “ipsum-app”</a></li>
<li class="book-part">Step 3: Build</li>
<li><a class="" href="build-app-golem.html"><span class="header-section-number">10</span> Building the App with {golem}</a></li>
<li class="book-part">Step 4: Strengthen</li>
<li><a class="" href="build-yourself-safety-net.html"><span class="header-section-number">11</span> Build Yourself a Safety Net</a></li>
<li><a class="" href="version-control.html"><span class="header-section-number">12</span> Version Control</a></li>
<li class="book-part">Step 5: Deploy</li>
<li><a class="" href="deploy.html"><span class="header-section-number">13</span> Deploy Your Application</a></li>
<li class="book-part">Optimizing</li>
<li><a class="" href="need-for-optimization.html"><span class="header-section-number">14</span> The Need for Optimization</a></li>
<li><a class="" href="common-app-caveats.html"><span class="header-section-number">15</span> Common Application Caveats</a></li>
<li><a class="" href="optimizing-shiny-code.html"><span class="header-section-number">16</span> Optimizing {shiny} Code</a></li>
<li><a class="" href="using-javascript.html"><span class="header-section-number">17</span> Using JavaScript</a></li>
<li><a class="" href="css.html"><span class="header-section-number">18</span> A Gentle Introduction to CSS</a></li>
<li class="book-part">Appendix</li>
<li><a class="active" href="appendix-a---use-case-building-an-app-from-start-to-finish.html">Appendix A - Use Case: Building an App from Start to Finish</a></li>
<li><a class="" href="appendix-b---session-info.html">Appendix B - Session Info</a></li>
<li><a class="" href="references.html">References</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/ThinkR-open/engineering-shiny-book">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="appendix-a---use-case-building-an-app-from-start-to-finish" class="section level1 unnumbered">
<h1>Appendix A - Use Case: Building an App from Start to Finish<a class="anchor" aria-label="anchor" href="#appendix-a---use-case-building-an-app-from-start-to-finish"><i class="fas fa-link"></i></a>
</h1>
<p>This chapter aims at exemplifying the workflow developed in this book using a “real-life” example.
In this appendix, we will be building a <a href="https://shiny.rstudio.com/">shiny</a> application from start to finish.
We’ve chosen to build an application that doesn’t rely on heavy computation/data analysis, so that we can focus on the engineering process, not on the internals of the analytic methodology, nor on spending time explaining the dataset.</p>
<div id="about-the-application" class="section level2 unnumbered">
<h2>About the application<a class="anchor" aria-label="anchor" href="#about-the-application"><i class="fas fa-link"></i></a>
</h2>
<p>In this appendix, we will build a “minify” application, an application that takes a CSS, JavaScript, HTML or JSON input, and outputs a minified version of this file.
We will rely on the <code>{minifyr}</code> package to build this application.</p>
<p>Here is an example of what the specifications for this app could look like:</p>
<div class="sourceCode" id="cb356"><pre class="sourceCode txt"><code class="sourceCode default"><span id="cb356-1"><a href="appendix-a---use-case-building-an-app-from-start-to-finish.html#cb356-1" tabindex="-1"></a>Hello! </span>
<span id="cb356-2"><a href="appendix-a---use-case-building-an-app-from-start-to-finish.html#cb356-2" tabindex="-1"></a></span>
<span id="cb356-3"><a href="appendix-a---use-case-building-an-app-from-start-to-finish.html#cb356-3" tabindex="-1"></a>We want to build a small application that can </span>
<span id="cb356-4"><a href="appendix-a---use-case-building-an-app-from-start-to-finish.html#cb356-4" tabindex="-1"></a>minify CSS, JavaScript, HTML and JSON. </span>
<span id="cb356-5"><a href="appendix-a---use-case-building-an-app-from-start-to-finish.html#cb356-5" tabindex="-1"></a></span>
<span id="cb356-6"><a href="appendix-a---use-case-building-an-app-from-start-to-finish.html#cb356-6" tabindex="-1"></a>In this app, user will be able either to paste </span>
<span id="cb356-7"><a href="appendix-a---use-case-building-an-app-from-start-to-finish.html#cb356-7" tabindex="-1"></a>the content or to upload a file. </span>
<span id="cb356-8"><a href="appendix-a---use-case-building-an-app-from-start-to-finish.html#cb356-8" tabindex="-1"></a></span>
<span id="cb356-9"><a href="appendix-a---use-case-building-an-app-from-start-to-finish.html#cb356-9" tabindex="-1"></a>Once the content is pasted/upladed, they select </span>
<span id="cb356-10"><a href="appendix-a---use-case-building-an-app-from-start-to-finish.html#cb356-10" tabindex="-1"></a>the type, which is pre-selected based on the </span>
<span id="cb356-11"><a href="appendix-a---use-case-building-an-app-from-start-to-finish.html#cb356-11" tabindex="-1"></a>file extension. Then they click on a button, </span>
<span id="cb356-12"><a href="appendix-a---use-case-building-an-app-from-start-to-finish.html#cb356-12" tabindex="-1"></a>and the content is minified. </span>
<span id="cb356-13"><a href="appendix-a---use-case-building-an-app-from-start-to-finish.html#cb356-13" tabindex="-1"></a></span>
<span id="cb356-14"><a href="appendix-a---use-case-building-an-app-from-start-to-finish.html#cb356-14" tabindex="-1"></a>They can then copy the output, or download it as a file. </span>
<span id="cb356-15"><a href="appendix-a---use-case-building-an-app-from-start-to-finish.html#cb356-15" tabindex="-1"></a></span>
<span id="cb356-16"><a href="appendix-a---use-case-building-an-app-from-start-to-finish.html#cb356-16" tabindex="-1"></a>Cheers!</span></code></pre></div>
</div>
<div id="step-1-design-1" class="section level2 unnumbered">
<h2>Step 1: Design<a class="anchor" aria-label="anchor" href="#step-1-design-1"><i class="fas fa-link"></i></a>
</h2>
<div id="deciphering-the-specifications" class="section level3 unnumbered">
<h3>Deciphering the specifications<a class="anchor" aria-label="anchor" href="#deciphering-the-specifications"><i class="fas fa-link"></i></a>
</h3>
<div id="general-observations" class="section level4 unnumbered">
<h4>General observations<a class="anchor" aria-label="anchor" href="#general-observations"><i class="fas fa-link"></i></a>
</h4>
<ul>
<li><p>As this app is pretty straightforward, it would be better to handle everything in the same page, <em>i.e</em> everything should happen on the same page (no tab).</p></li>
<li><p>It would be a plus to have the “before minification”/“after minification” gain, so that the users have a better idea of the purpose of the application.</p></li>
</ul>
</div>
<div id="user-experience-considerations" class="section level4 unnumbered">
<h4>User experience considerations<a class="anchor" aria-label="anchor" href="#user-experience-considerations"><i class="fas fa-link"></i></a>
</h4>
<ul>
<li><p>We should provide a link to an explanation of minification.</p></li>
<li><p>The user might get different results based on the minifying algorithm they use, which can be surprising at first.
The application should alert about this.</p></li>
<li><p>For long printed outputs, if we use <code>verbatimTextOuput</code>, we should be careful about the page width, as these elements will natively overflow on the x-axis of the page.
This should be doable with the following CSS: <code>pre{ white-space: pre-wrap; word-break: keep-all; }</code>.</p></li>
<li><p>We should be careful about using semantic HTML for the inputs and outputs.</p></li>
</ul>
</div>
<div id="technical-points" class="section level4 unnumbered">
<h4>Technical points<a class="anchor" aria-label="anchor" href="#technical-points"><i class="fas fa-link"></i></a>
</h4>
<ul>
<li><p>As <code>{minifyr}</code> wraps a NodeJS module, we will need to install NodeJS when deploying.</p></li>
<li><p>To be sure that the process works, we should check the validity of the file extension from the UI and from the server side.</p></li>
</ul>
</div>
</div>
<div id="building-a-concept-map" class="section level3 unnumbered">
<h3>Building a concept map<a class="anchor" aria-label="anchor" href="#building-a-concept-map"><i class="fas fa-link"></i></a>
</h3>
<p>Figure <a href="#fig:19-appendix-1"><strong>??</strong></a> is the concept map for this application, using Xmind.</p>

</div>
<div id="asking-questions" class="section level3 unnumbered">
<h3>Asking questions<a class="anchor" aria-label="anchor" href="#asking-questions"><i class="fas fa-link"></i></a>
</h3>
<div id="about-the-end-users-1" class="section level4 unnumbered">
<h4>About the end users<a class="anchor" aria-label="anchor" href="#about-the-end-users-1"><i class="fas fa-link"></i></a>
</h4>
<ul>
<li><em>Who are the end users of your app?</em></li>
</ul>
<p>This application is mainly useful for web developers.</p>
<ul>
<li><em>Are they tech-literate?</em></li>
</ul>
<p>Yes.</p>
<ul>
<li><em>In which context will they be using your app?</em></li>
</ul>
<p>Notably at work, or while building pet projects.</p>
<ul>
<li><em>On what machines?</em></li>
</ul>
<p>Laptop/personal computer.
Small chance of using this on a smartphone.</p>
<ul>
<li><em>What browser version will they be using?</em></li>
</ul>
<p>Hard to say, but given that we aim for a public of community developers, probably modern browsers.</p>
<ul>
<li><em>Will they be using the app in their office, on their phone while driving a tractor, in a plant, or while wearing lab coats?</em></li>
</ul>
<p>Nothing of the like: they should be using this application while developing, so chances are they are using it at a desk.</p>
</div>
</div>
<div id="building-personas-1" class="section level3 unnumbered">
<h3>Building personas<a class="anchor" aria-label="anchor" href="#building-personas-1"><i class="fas fa-link"></i></a>
</h3>
<p>Let’s pick two random names for our personas, and two fake companies where they might be working.</p>
<div class="sourceCode" id="cb357"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nms</span> <span class="op">&lt;-</span> <span class="fu">withr</span><span class="fu">::</span><span class="fu"><a href="https://withr.r-lib.org/reference/with_seed.html">with_seed</a></span><span class="op">(</span></span>
<span>  <span class="fl">608</span>, <span class="op">{</span></span>
<span>    <span class="fu">charlatan</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/charlatan/reference/ch_name.html">ch_name</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span></span>
<span>    </span>
<span>  <span class="op">}</span></span>
<span><span class="op">)</span></span>
<span><span class="va">nms</span></span></code></pre></div>
<pre><code>[1] "Delina Stanton" "Theo Torphy"   </code></pre>
<div class="sourceCode" id="cb359"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">company</span> <span class="op">&lt;-</span> <span class="fu">withr</span><span class="fu">::</span><span class="fu"><a href="https://withr.r-lib.org/reference/with_seed.html">with_seed</a></span><span class="op">(</span></span>
<span>  <span class="fl">608</span>, <span class="op">{</span></span>
<span>    <span class="fu">charlatan</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/charlatan/reference/ch_company.html">ch_company</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">)</span></span>
<span><span class="va">company</span></span></code></pre></div>
<pre><code>[1] "Witting-Witting" "Stehr-Stehr"    </code></pre>
<div id="delina-stanton-shiny-developer-at-witting-witting" class="section level4 unnumbered">
<h4>Delina Stanton: <code>{shiny}</code> developer at Witting-Witting<a class="anchor" aria-label="anchor" href="#delina-stanton-shiny-developer-at-witting-witting"><i class="fas fa-link"></i></a>
</h4>
<p>Delina Stanton is a <a href="https://shiny.rstudio.com/">shiny</a> developer at Witting-Witting.
She’s been learning R in graduate school while working on her master’s degree in statistics.
When she started at Witting-Witting, she was mainly doing data analysis in Rmd, but has gradually switched to building <a href="https://shiny.rstudio.com/">shiny</a> applications full-time.
She discovered minification while reading the “Engineering Production-Grade Shiny App” book, and now wants to add this to her <a href="https://shiny.rstudio.com/">shiny</a> application.</p>
</div>
<div id="theo-torphy-web-developer-and-trainer-at-stehr-stehr" class="section level4 unnumbered">
<h4>Theo Torphy: web developer and trainer at Stehr-Stehr<a class="anchor" aria-label="anchor" href="#theo-torphy-web-developer-and-trainer-at-stehr-stehr"><i class="fas fa-link"></i></a>
</h4>
<p>Theo Torphy is a web developer at Stehr-Stehr.
He studied web development at the university, where he learned about minification.
He is now also in charge of training new recruits for the company where he works, and also gives some lectures at the university he attended.
Most of the minification he does is automated, but he is looking for a tool he can use during training and classes to explain how minification works.</p>
<p>This step is available at <a href="https://github.com/ColinFay/minifying/tree/master/step-1-design" class="uri">https://github.com/ColinFay/minifying/tree/master/step-1-design</a>.</p>
</div>
</div>
</div>
<div id="step-2-prototyping" class="section level2 unnumbered">
<h2>Step 2: Prototyping<a class="anchor" aria-label="anchor" href="#step-2-prototyping"><i class="fas fa-link"></i></a>
</h2>
<p>In this step, we will be building the back-end of the application on one side, and the UI on the other side.
Once we have the back-end settled and the UI defined, we will be working on making the two work with each other.</p>
<div id="back-end-in-rmd" class="section level3 unnumbered">
<h3>Back-end in Rmd<a class="anchor" aria-label="anchor" href="#back-end-in-rmd"><i class="fas fa-link"></i></a>
</h3>
<p>Our back-end will be composed of two functions:</p>
<ul>
<li>
<code>guess_minifier</code>, which will take a function and return the available algorithms for that file: for example, if you have a JavaScript file, you’ll be able to use the <code><a href="https://rdrr.io/pkg/minifyr/man/js.html">minifyr_js_babel()</a></code>, <code><a href="https://rdrr.io/pkg/minifyr/man/js.html">minifyr_js_gcc()</a></code>, <code><a href="https://rdrr.io/pkg/minifyr/man/js.html">minifyr_js_terser()</a></code>, <code><a href="https://rdrr.io/pkg/minifyr/man/js.html">minifyr_js_uglify()</a></code>, and <code><a href="https://rdrr.io/pkg/minifyr/man/js.html">minifyr_js_yui()</a></code> functions. If the type is not guessed based on the extension, the function should fail gracefully, and not make <a href="https://shiny.rstudio.com/">shiny</a> crash. We’ll chose to return an empty string if this extension is not guessed.</li>
</ul>
<div class="sourceCode" id="cb361"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">minifyr</span><span class="op">)</span></span>
<span><span class="va">guess_minifier</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">file</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="co"># We'll start by getting the file extension</span></span>
<span>  <span class="va">ext</span> <span class="op">&lt;-</span> <span class="fu">tools</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/tools/fileutils.html">file_ext</a></span><span class="op">(</span><span class="va">file</span><span class="op">)</span></span>
<span>  <span class="co"># Check that the extension is correct, if not, return early</span></span>
<span>  <span class="co"># It's important to do this kind of check also </span></span>
<span>  <span class="co"># on the server side as HTML manual tempering </span></span>
<span>  <span class="co"># would allow to also send other type of files</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span></span>
<span>    <span class="op">!</span> <span class="va">ext</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"js"</span>, <span class="st">"css"</span>, <span class="st">"html"</span>, <span class="st">"json"</span><span class="op">)</span></span>
<span>  <span class="op">)</span><span class="op">{</span></span>
<span>    <span class="co"># Return early</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="co"># We'll then retrieve the available </span></span>
<span>  <span class="co"># pattern based on the extension</span></span>
<span>  <span class="va">patt</span> <span class="op">&lt;-</span> <span class="kw"><a href="https://rdrr.io/r/base/switch.html">switch</a></span><span class="op">(</span></span>
<span>    <span class="va">ext</span>, </span>
<span>    js <span class="op">=</span> <span class="st">"minifyr_js_.+"</span>,</span>
<span>    html <span class="op">=</span> <span class="st">"minifyr_html_.+"</span>,</span>
<span>    css <span class="op">=</span> <span class="st">"minifyr_css_.+"</span>,</span>
<span>    json <span class="op">=</span> <span class="st">"minifyr_json_.+"</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="co"># List all the available functions to minify the file</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span></span>
<span>    file <span class="op">=</span> <span class="va">file</span>,</span>
<span>    ext <span class="op">=</span> <span class="va">ext</span>,</span>
<span>    <span class="co"># We return this pattern so that </span></span>
<span>    <span class="co"># it will be used to update the selectInput that </span></span>
<span>    <span class="co"># is used to select an algo</span></span>
<span>    pattern <span class="op">=</span> <span class="va">patt</span>, </span>
<span>    functions <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">grep</a></span><span class="op">(</span></span>
<span>      <span class="va">patt</span>, </span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/ns-load.html">loadNamespace</a></span><span class="op">(</span><span class="st">"minifyr"</span><span class="op">)</span></span>
<span>      <span class="op">)</span>, </span>
<span>      value <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span>  </span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># minifyr comes with a series of examples, </span></span>
<span><span class="co"># so we can use them as tests</span></span>
<span><span class="fu">guess_minifier</span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/minifyr/man/minifyr_example.html">minifyr_example</a></span><span class="op">(</span><span class="st">"css"</span><span class="op">)</span></span>
<span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span></span>
<span><span class="fu">guess_minifier</span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/minifyr/man/minifyr_example.html">minifyr_example</a></span><span class="op">(</span><span class="st">"js"</span><span class="op">)</span></span>
<span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span></span>
<span><span class="fu">guess_minifier</span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/minifyr/man/minifyr_example.html">minifyr_example</a></span><span class="op">(</span><span class="st">"html"</span><span class="op">)</span></span>
<span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span></span>
<span><span class="fu">guess_minifier</span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/minifyr/man/minifyr_example.html">minifyr_example</a></span><span class="op">(</span><span class="st">"json"</span><span class="op">)</span></span>
<span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span></span>
<span><span class="co"># Try with a non valid extension</span></span>
<span><span class="fu">guess_minifier</span><span class="op">(</span></span>
<span>  <span class="st">"path/to/text.docx"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<ul>
<li>A <code>compress()</code> function, which takes three parameters: the file as <code>input</code>, the <code>algo</code> outputted from our last function, and the selection, which is the one selected by the user. The compressed file will be outputted to a tempfile.</li>
</ul>
<div class="sourceCode" id="cb362"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">compress</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">algo</span>, <span class="va">selection</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="co"># Creating a tempfile using our algo object</span></span>
<span>  <span class="va">tps</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html">tempfile</a></span><span class="op">(</span>fileext <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html">sprintf</a></span><span class="op">(</span><span class="st">".%s"</span>, <span class="va">algo</span><span class="op">$</span><span class="va">ext</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="co"># Getting the function with the selection</span></span>
<span>  <span class="va">converter</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/grep.html">grep</a></span><span class="op">(</span><span class="va">selection</span>, <span class="va">algo</span><span class="op">$</span><span class="va">functions</span>, value <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="co"># Do the conversion</span></span>
<span>  <span class="fu">converter</span><span class="op">(</span><span class="va">algo</span><span class="op">$</span><span class="va">file</span>, <span class="va">tps</span><span class="op">)</span></span>
<span>  <span class="co"># Return the temp file</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">tps</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">algo</span> <span class="op">&lt;-</span> <span class="fu">guess_minifier</span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/minifyr/man/minifyr_example.html">minifyr_example</a></span><span class="op">(</span><span class="st">"js"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">compress</span><span class="op">(</span></span>
<span>  algo <span class="op">=</span> <span class="va">algo</span>, </span>
<span>  selection <span class="op">=</span> <span class="st">"babel"</span></span>
<span><span class="op">)</span> </span></code></pre></div>
<ul>
<li>Finally, a <code><a href="https://testthat.r-lib.org/reference/compare.html">compare()</a></code> function, that can compare the size of two files, so that we can measure the minification gain. This function will take two file paths.</li>
</ul>
<div class="sourceCode" id="cb363"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">compare</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">original</span>, <span class="va">minified</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="co"># Get the file size of both</span></span>
<span>  <span class="va">original</span> <span class="op">&lt;-</span> <span class="fu">fs</span><span class="fu">::</span><span class="fu"><a href="https://fs.r-lib.org/reference/file_info.html">file_info</a></span><span class="op">(</span><span class="va">original</span><span class="op">)</span><span class="op">$</span><span class="va">size</span></span>
<span>  <span class="va">minified</span> <span class="op">&lt;-</span> <span class="fu">fs</span><span class="fu">::</span><span class="fu"><a href="https://fs.r-lib.org/reference/file_info.html">file_info</a></span><span class="op">(</span><span class="va">minified</span><span class="op">)</span><span class="op">$</span><span class="va">size</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">original</span> <span class="op">-</span> <span class="va">minified</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>So, for the complete process:</p>
<div class="sourceCode" id="cb364"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">algo</span> <span class="op">&lt;-</span> <span class="fu">guess_minifier</span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/minifyr/man/minifyr_example.html">minifyr_example</a></span><span class="op">(</span><span class="st">"js"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">compressed</span> <span class="op">&lt;-</span> <span class="fu">compress</span><span class="op">(</span></span>
<span>  algo <span class="op">=</span> <span class="va">algo</span>, </span>
<span>  selection <span class="op">=</span> <span class="st">"babel"</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://testthat.r-lib.org/reference/compare.html">compare</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/minifyr/man/minifyr_example.html">minifyr_example</a></span><span class="op">(</span><span class="st">"js"</span><span class="op">)</span>, </span>
<span>  <span class="va">compressed</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Now, time to move this into a vignette!</p>
</div>
<div id="ui-prototyping" class="section level3 unnumbered">
<h3>UI prototyping<a class="anchor" aria-label="anchor" href="#ui-prototyping"><i class="fas fa-link"></i></a>
</h3>
<p>Let’s start by drawing a small mockup of our front-end using <a href="https://excalidraw.com/">Excalidraw</a>, as seen in Figure <a href="#fig:19-appendix-8"><strong>??</strong></a>.</p>

<p>We would love this application to be “full screen”, and to do that, we’ll take inspiration from the <a href="https://www.w3schools.com/howto/howto_css_split_screen.asp">split-screen layout</a> available at W3Schools.
To mock up the UI, we will also use the <a href="https://github.com/Thinkr-open/shinipsum">shinipsum</a> package.</p>
<p>In this first step, we will start generating the module skeleton for the application.
Here, we will have a <code>left</code> module for the left part of the app, and a <code>right</code> module for the right part.
Each will receive their corresponding <code>class</code>, based on the CSS from W3.
Now that these two spots are available, we’ll add the two modules, with some fake output, to simulate our application behavior.
The left side will be functional in the sense that uploading a file will randomly add algorithms to the <code><a href="https://rdrr.io/pkg/shiny/man/selectInput.html">selectInput()</a></code>, and clicking on <code>Launch the minification</code> will regenerate a fake text.</p>
<p>Now, let’s pick a soft palette of colors, using <a href="https://coolors.co/palettes/">coolors.co</a>, and a font family from <a href="https://fonts.google.com/">fonts.google.com</a>.
We went for:</p>
<ul>
<li>One of the monochrome palettes from <a href="https://coolors.co/fbfbf2-e5e6e4-cfd2cd-a6a2a2-847577">coolors.co</a>.</li>
<li>The <code>Sora</code> font <a href="https://fonts.google.com/specimen/Sora">fonts.google.com/specimen/Sora</a>. There is not that much text displayed on the screen, so this font should work well.</li>
</ul>
<p>We then used CSS to arrange our page: size, padding, alignment, colors, etc.
If you want to know more about this file, it’s located in the <code>inst/app/www</code> folder of the package.</p>
<p>This step is available at <a href="https://github.com/ColinFay/minifying/tree/master/step-2-prototype">github.com/ColinFay/minifying, folder step-2-prototype</a>.</p>
</div>
</div>
<div id="step-3-build-1" class="section level2 unnumbered">
<h2>Step 3: Build<a class="anchor" aria-label="anchor" href="#step-3-build-1"><i class="fas fa-link"></i></a>
</h2>
<p>Now we’ve got the back-end in an Rmd, the front end working with <a href="https://github.com/Thinkr-open/shinipsum">shinipsum</a>.
Now is the time to make the two work together!</p>
<p>Here is the logic we will be adding to the application:</p>
<ul>
<li><p>When a file is uploaded, we also check the format from the server-side: the UI restriction with the <code>accept</code> parameter of <code><a href="https://rdrr.io/pkg/shiny/man/fileInput.html">fileInput()</a></code> will not be enough to stop users who <strong>really</strong> want to upload something else.</p></li>
<li><p>If the file comes with the right extension, we update the algorithm selection and read it inside the “Original content” block.</p></li>
<li><p>Once the user clicks on “Launch the minification”, we create a temp file and minify the original file inside this temp file.</p></li>
<li><p>When the file is minified, we update the gain output to reflect how many bytes have been gained from the minification, and add the result of this minification to the “Minified content” block.</p></li>
<li><p>Finally, when the “Download the output” button is clicked, the minified file is downloaded.</p></li>
</ul>
<p>During this process, we will migrate the functions from the Rmd to files inside the <code>R/</code> folder, use external dependencies, and document our business logic functions.
You can refer to the <code>dev/02_dev.R</code> file if you want to read the exact steps taken here.</p>
<p>This step is available at <a href="https://github.com/ColinFay/minifying/tree/master/step-3-build" class="uri">https://github.com/ColinFay/minifying/tree/master/step-3-build</a>.</p>
</div>
<div id="step-4-strengthen-1" class="section level2 unnumbered">
<h2>Step 4: Strengthen<a class="anchor" aria-label="anchor" href="#step-4-strengthen-1"><i class="fas fa-link"></i></a>
</h2>
<p>As of now, we have a working application.
Time to strengthen it!</p>
<p>Here are the few steps we will be working on:</p>
<ul>
<li><p>Turning our business logic into an R6 class.
This R6 class will generate an object at the very start of our app, and it will be passed into the modules.</p></li>
<li><p>As the minification process takes a couple of seconds, we will add a small progress bar so that the user knows something is happening.</p></li>
<li><p>As we will use R6, we will need to manually set the reactive context invalidation.
To do so, we will use <code>triggers</code> from <a href="https://github.com/ColinFay/gargoyle">gargoyle</a>.</p></li>
<li><p>Chances are, users will be testing several algorithms when using the application, and we don’t want the minification process to happen another time when it is called on the same file and with the same algorithm.
This is even even more important because the process involves calling an external NodeJS process.
To prevent that, we will be caching the function that does the computation.</p></li>
<li><p>Create an unseen input that will upload data, so that we can build an interactivity test using <a href="https://github.com/ColinFay/crrry">crrry</a>.
This input will look like the following on the server:</p></li>
</ul>
<div class="sourceCode" id="cb365"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/shiny/man/observeEvent.html">observeEvent</a></span><span class="op">(</span> <span class="va">input</span><span class="op">$</span><span class="va">testingtrigger</span> , <span class="op">{</span></span>
<span>  </span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu">golem</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/golem/man/prod.html">app_dev</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">file</span><span class="op">$</span><span class="va">original_file</span> <span class="op">&lt;-</span> <span class="fu">minifyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/minifyr/man/minifyr_example.html">minifyr_example</a></span><span class="op">(</span></span>
<span>      ext <span class="op">=</span> <span class="va">input</span><span class="op">$</span><span class="va">testingtext</span></span>
<span>    <span class="op">)</span></span>
<span>    <span class="va">file</span><span class="op">$</span><span class="fu">guess_minifier</span><span class="op">(</span><span class="op">)</span></span>
<span>    <span class="va">file</span><span class="op">$</span><span class="va">type</span> <span class="op">&lt;-</span> <span class="va">input</span><span class="op">$</span><span class="va">upload</span><span class="op">$</span><span class="va">type</span></span>
<span>    <span class="va">file</span><span class="op">$</span><span class="va">minified_file</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span>    <span class="va">file</span><span class="op">$</span><span class="va">original_name</span> <span class="op">&lt;-</span> <span class="va">input</span><span class="op">$</span><span class="va">upload</span><span class="op">$</span><span class="va">name</span></span>
<span>    <span class="fu">gargoyle</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/gargoyle/man/Event.html">trigger</a></span><span class="op">(</span><span class="st">"uploaded"</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<p>We use this pattern so that we can combine it with a testing suite with <a href="https://github.com/ColinFay/crrry">crrry</a>, using the following pattern:</p>
<div class="sourceCode" id="cb366"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">test</span> <span class="op">&lt;-</span> <span class="fu">crrry</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/crrry/man/CrrryProc.html">CrrryProc</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span></span>
<span>  chrome_bin <span class="op">=</span> <span class="fu">pagedown</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pagedown/man/find_chrome.html">find_chrome</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  <span class="co"># Process to launch locally</span></span>
<span>  fun <span class="op">=</span> <span class="st">"golem::document_and_reload();run_app()"</span>,</span>
<span>  <span class="co"># Note that you will need httpuv &gt;= 1.5.2 for randomPort</span></span>
<span>  chrome_port <span class="op">=</span> <span class="fu">httpuv</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/httpuv/man/randomPort.html">randomPort</a></span><span class="op">(</span><span class="op">)</span>, </span>
<span>  headless <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">test</span><span class="op">$</span><span class="fu">wait_for_shiny_ready</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">ext</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"css"</span>, <span class="st">"js"</span>, <span class="st">"json"</span>, <span class="st">"html"</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">ext</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="co"># Set the extension value</span></span>
<span>  <span class="va">test</span><span class="op">$</span><span class="fu">shiny_set_input</span><span class="op">(</span><span class="st">"left_ui_1-testingtext"</span>, <span class="va">ext</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="co"># Trigger the file to be read</span></span>
<span>  <span class="va">test</span><span class="op">$</span><span class="fu">shiny_set_input</span><span class="op">(</span><span class="st">"left_ui_1-testingtrigger"</span>, <span class="va">i</span><span class="op">)</span></span>
<span>  <span class="co"># Launch the minification</span></span>
<span>  <span class="va">test</span><span class="op">$</span><span class="fu">shiny_set_input</span><span class="op">(</span><span class="st">"left_ui_1-launch"</span>, <span class="va">i</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">test</span><span class="op">$</span><span class="kw">stop</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>It’s safer to wrap these tests between <code>if(interactive())</code>, as running the checks outside of your current session might not launch the app correctly, and launching external processes (the one running the app with Chrome) might fail when run non-interactively.
And on top of that, running these inside your CI might cause some pain, and of course, it will not work on CRAN checks.</p>
<p>We’ll also be building “standard” function checks, which you can find in the <code>test/</code> folder.</p>
<p>This step is available at <a href="https://github.com/ColinFay/minifying/tree/master/step-4-strengthen">github.com/ColinFay/minifying, folder step-4-strengthen</a>.</p>
</div>
<div id="step-5-deploy-1" class="section level2 unnumbered">
<h2>Step 5: Deploy<a class="anchor" aria-label="anchor" href="#step-5-deploy-1"><i class="fas fa-link"></i></a>
</h2>
<p>As an example, we will deploy this app in three media: as a package, on RStudio Connect, and with Docker.</p>
<div id="before-deployment-checklist-1" class="section level3 unnumbered">
<h3>Before deployment checklist<a class="anchor" aria-label="anchor" href="#before-deployment-checklist-1"><i class="fas fa-link"></i></a>
</h3>
<ul class="task-list">
<li><p><label><input type="checkbox" checked><em><code><a href="https://devtools.r-lib.org/reference/check.html">devtools::check()</a></code>, run from the command line, return 0 errors, 0 warnings, 0 notes</em></label></p></li>
<li><p><label><input type="checkbox" checked><em>The current version number is valid, i.e</em> if the current app is an update, the version number has been bumped: it makes sense, before the first deployment, to keep a version number of <code>0.0.0.9000</code>, and increment this dev version whenever we implement changes or do test deployments.
Because this is a “true” deployment, we bumped the version to <code>0.1.0</code>.</label></p></li>
<li><p><label><input type="checkbox" checked><em>Everything is fully documented</em>: we have documented all the functions, even the internal, there is a Vignette that describes the business logic, and the README is filled.</label></p></li>
<li><p><label><input type="checkbox" checked><em>Test coverage is good, i.e. you cover a sufficient amount of the codebase, and these tests cover the core/strategic algorithms</em>.</label></p></li>
<li><p><label><input type="checkbox" checked><em>The person to call if something goes wrong is clear to everyone involved in the product.</em>.</label></p></li>
<li><p><label><input type="checkbox" checked><em>The debugging process is clear to everyone involved in the project, including how to communicate bugs to the developer team, and how long it will take to get changes implemented</em>: this project will be made open source, so the bug will have to be listed on the Github repo.
To help that, we added a link to the GitHub repository on the application.</label></p></li>
<li><p><label><input type="checkbox" checked><em>(If relevant) The server it is deployed on has all the necessary software installed (Docker, Connect, <code>Shiny Server</code>, etc.) to make the application run</em>.</label></p></li>
<li><p><label><input type="checkbox" checked><em>The server has all the system requirements needed (the system libraries), and if not, they are installed with the application (if it’s dockerized)</em>: NodeJS will need to be installed on Docker and on the server running RStudio Connect.
A check is also added on top of <code>run_app()</code> for the availability of NodeJS on the system, especially for people installing it as a package.
This check will also check if <code>node-minify</code> has been installed, and if not, it will be installed.
This check might take some time to run, but it will only be performed the first time the app is launched.</label></p></li>
<li><p><label><input type="checkbox" checked><em>The application, if deployed on a server, will be deployed on a port which will be accessible by the users</em>: when building the Dockerfile using <a href="https://github.com/ThinkR-open/golem">golem</a>, the correct port is exposed (<em>i.e</em> the app will run on port 80, which is also made available).
For the other medium, the port will be automatically chosen, either by <a href="https://shiny.rstudio.com/">shiny</a> or by Connect.</label></p></li>
<li><p><label><input type="checkbox" checked><em>(If relevant) The environment variables from the production server are managed inside the application</em>: not relevant.</label></p></li>
<li><p><label><input type="checkbox" checked><em>(If relevant) The app is launched on the correct port, or at least this port can be configured via an environment variable</em>: not relevant.</label></p></li>
<li><p><label><input type="checkbox" checked><em>(If relevant) The server where the app is deployed has access to the data sources (database, API…)</em>: not relevant.</label></p></li>
<li><p><label><input type="checkbox" checked><em>If the app records data and there are backups for these data</em>: not relevant</label></p></li>
</ul>
</div>
<div id="deploy-as-a-tar.gz" class="section level3 unnumbered">
<h3>Deploy as a tar.gz<a class="anchor" aria-label="anchor" href="#deploy-as-a-tar.gz"><i class="fas fa-link"></i></a>
</h3>
<p>To share an application as a tar.gz, you can call <code><a href="https://devtools.r-lib.org/reference/build.html">devtools::build()</a></code>, which will compile a <code>tar.gz</code> file inside the parent folder of your current application.
You can then share this archive, and install it with <code>remotes::install_local("path/to/tar.gz")</code>.
Note that this can also be done with base R, but <a href="https://remotes.r-lib.org">remotes</a> offers a smarter way when it comes to managing the dependencies of your archived package.</p>
<p>This <code>tar.gz</code> can also be sent to a package repository; be it the CRAN or any other package manager you might have in your company.</p>
</div>
<div id="deploy-on-rstudio-connect" class="section level3 unnumbered">
<h3>Deploy on RStudio Connect<a class="anchor" aria-label="anchor" href="#deploy-on-rstudio-connect"><i class="fas fa-link"></i></a>
</h3>
<p>Once we are sure that the server running Connect has NodeJS installed, and that we have installed the minify module with <code><a href="https://rdrr.io/pkg/minifyr/man/minifyr_npm_install.html">minifyr::minifyr_npm_install()</a></code>, we can create the app.R using <code><a href="https://rdrr.io/pkg/golem/man/rstudio_deploy.html">golem::add_rstudioconnect_file()</a></code>, and then push to the Connect server.</p>
</div>
<div id="deploy-with-docker" class="section level3 unnumbered">
<h3>Deploy with Docker<a class="anchor" aria-label="anchor" href="#deploy-with-docker"><i class="fas fa-link"></i></a>
</h3>
<p>To create the <code>Dockerfile</code>, we’ll start by launching <code><a href="https://rdrr.io/pkg/golem/man/dockerfiles.html">golem::add_dockerfile()</a></code>.
This function will compute the system requirements,<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content="&lt;p&gt;Note that at the time of writing these lines, there is also an issue with the dependencies collected by the &lt;code&gt;sysreq&lt;/code&gt; API, leading to an issue when attempting to compile the Dockerfile.
Removing the installation of &lt;code&gt;libgit2-dev&lt;/code&gt; solved the issue.&lt;/p&gt;"><sup>73</sup></a> and create a generic <code>Dockerfile</code> for your application.
Once this is done, we will create/update the <code>.dockerignore</code> file at the root of the package, so that unwanted files are not bundled with our Docker image.</p>
<p>Inside our <code>Dockerfile</code>, we will also change the default repo to use <a href="https://packagemanager.rstudio.com/all/latest" class="uri">https://packagemanager.rstudio.com/all/latest</a>, which proposes precompiled packages for our system, making the installation faster.
We will also add an installation of NodeJS, which is needed by our application..</p>
<p>Then, we can go to our terminal and compile the image!</p>
<div class="sourceCode" id="cb367"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb367-1"><a href="appendix-a---use-case-building-an-app-from-start-to-finish.html#cb367-1" tabindex="-1"></a><span class="ex">docker</span> build <span class="at">-t</span> minifying . </span></code></pre></div>
<p>Now we’ve got a working image!
We can try it with:</p>
<div class="sourceCode" id="cb368"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb368-1"><a href="appendix-a---use-case-building-an-app-from-start-to-finish.html#cb368-1" tabindex="-1"></a><span class="ex">docker</span> run <span class="at">-p</span> 2811:80 minifying</span></code></pre></div>
<p>This step is available at <a href="https://github.com/ColinFay/minifying/tree/master/step-5-deploy">github.com/ColinFay/minifying, folder step-5-deploy</a>.</p>

</div>
</div>
</div>

<hr>
<footer><a href="https://rtask.thinkr.fr"><img src="img/logo400_129.png" alt="ThinkR Website"></a>
<!--https://yihui.org/en/2018/09/target-blank/-->
<script>
  (function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
</script></footer><div class="chapter-nav">
<div class="prev"><a href="css.html"><span class="header-section-number">18</span> A Gentle Introduction to CSS</a></div>
<div class="next"><a href="appendix-b---session-info.html">Appendix B - Session Info</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#appendix-a---use-case-building-an-app-from-start-to-finish">Appendix A - Use Case: Building an App from Start to Finish</a></li>
<li><a class="nav-link" href="#about-the-application">About the application</a></li>
<li>
<a class="nav-link" href="#step-1-design-1">Step 1: Design</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#deciphering-the-specifications">Deciphering the specifications</a></li>
<li><a class="nav-link" href="#building-a-concept-map">Building a concept map</a></li>
<li><a class="nav-link" href="#asking-questions">Asking questions</a></li>
<li><a class="nav-link" href="#building-personas-1">Building personas</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#step-2-prototyping">Step 2: Prototyping</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#back-end-in-rmd">Back-end in Rmd</a></li>
<li><a class="nav-link" href="#ui-prototyping">UI prototyping</a></li>
</ul>
</li>
<li><a class="nav-link" href="#step-3-build-1">Step 3: Build</a></li>
<li><a class="nav-link" href="#step-4-strengthen-1">Step 4: Strengthen</a></li>
<li>
<a class="nav-link" href="#step-5-deploy-1">Step 5: Deploy</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#before-deployment-checklist-1">Before deployment checklist</a></li>
<li><a class="nav-link" href="#deploy-as-a-tar.gz">Deploy as a tar.gz</a></li>
<li><a class="nav-link" href="#deploy-on-rstudio-connect">Deploy on RStudio Connect</a></li>
<li><a class="nav-link" href="#deploy-with-docker">Deploy with Docker</a></li>
</ul>
</li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/ThinkR-open/engineering-shiny-book/blob/master/19-appendix.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/ThinkR-open/engineering-shiny-book/edit/master/19-appendix.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Engineering Production-Grade Shiny Apps</strong>" was written by Colin Fay, Sébastien Rochette, Vincent Guyader, Cervan Girard. It was last built on 2024-03-12.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
