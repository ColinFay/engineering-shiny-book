<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 10 Building the App with {golem} | Engineering Production-Grade Shiny Apps</title>
<meta name="author" content="Colin Fay">
<meta name="author" content="Sébastien Rochette">
<meta name="author" content="Vincent Guyader">
<meta name="author" content="Cervan Girard">
<meta name="description" content="Now that the application is prototyped inside a {golem} (Fay, Guyader, Rochette, et al. 2023) skeleton, you can work on its integration. In this step of the workflow, you will be linking the...">
<meta name="generator" content="bookdown 0.33 with bs4_book()">
<meta property="og:title" content="Chapter 10 Building the App with {golem} | Engineering Production-Grade Shiny Apps">
<meta property="og:type" content="book">
<meta property="og:image" content="https://raw.githubusercontent.com/ThinkR-open/engineering-shiny-book/master/img/engineering-shiny.jpg">
<meta property="og:description" content="Now that the application is prototyped inside a {golem} (Fay, Guyader, Rochette, et al. 2023) skeleton, you can work on its integration. In this step of the workflow, you will be linking the...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chapter 10 Building the App with {golem} | Engineering Production-Grade Shiny Apps">
<meta name="twitter:description" content="Now that the application is prototyped inside a {golem} (Fay, Guyader, Rochette, et al. 2023) skeleton, you can work on its integration. In this step of the workflow, you will be linking the...">
<meta name="twitter:image" content="https://raw.githubusercontent.com/ThinkR-open/engineering-shiny-book/master/img/engineering-shiny.jpg">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap/bootstrap.bundle.min.js"></script><script src="libs/bs3compat/transition.js"></script><script src="libs/bs3compat/tabs.js"></script><script src="libs/bs3compat/bs3compat.js"></script><link href="libs/bs4_book/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book/bs4_book.js"></script><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-149994171-1"></script><script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-149994171-1');
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<style type="text/css">
    /* Used with Pandoc 2.11+ new --citeproc when CSL is used */
    div.csl-bib-body { }
    div.csl-entry {
      clear: both;
          margin-bottom: 0em;
        }
    .hanging div.csl-entry {
      margin-left:2em;
      text-indent:-2em;
    }
    div.csl-left-margin {
      min-width:2em;
      float:left;
    }
    div.csl-right-inline {
      margin-left:2em;
      padding-left:1em;
    }
    div.csl-indent {
      margin-left: 2em;
    }
  </style>
<link rel="stylesheet" href="css/style.css">
<link rel="stylesheet" href="css/thinkr.css">
<link rel="stylesheet" href="css/style_gitbook.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Engineering Production-Grade Shiny Apps</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Introduction</a></li>
<li><a class="" href="foreword.html">Foreword</a></li>
<li><a class="" href="application-presentation.html">Application presentation</a></li>
<li class="book-part">Building Successful {shiny} Apps</li>
<li><a class="" href="successful-shiny-app.html"><span class="header-section-number">1</span> About Successful {shiny} Apps</a></li>
<li><a class="" href="planning-ahead.html"><span class="header-section-number">2</span> Planning Ahead</a></li>
<li><a class="" href="structuring-project.html"><span class="header-section-number">3</span> Structuring Your Project</a></li>
<li><a class="" href="golem.html"><span class="header-section-number">4</span> Introduction to {golem}</a></li>
<li><a class="" href="workflow.html"><span class="header-section-number">5</span> The Workflow</a></li>
<li class="book-part">Step 1: Design</li>
<li><a class="" href="ux-matters.html"><span class="header-section-number">6</span> UX Matters</a></li>
<li><a class="" href="dont-rush-into-coding.html"><span class="header-section-number">7</span> Don’t Rush into Coding</a></li>
<li class="book-part">Step 2: Prototype</li>
<li><a class="" href="setting-up-for-success.html"><span class="header-section-number">8</span> Setting up for Success with {golem}</a></li>
<li><a class="" href="building-ispum-app.html"><span class="header-section-number">9</span> Building an “ipsum-app”</a></li>
<li class="book-part">Step 3: Build</li>
<li><a class="active" href="build-app-golem.html"><span class="header-section-number">10</span> Building the App with {golem}</a></li>
<li class="book-part">Step 4: Strengthen</li>
<li><a class="" href="build-yourself-safety-net.html"><span class="header-section-number">11</span> Build Yourself a Safety Net</a></li>
<li><a class="" href="version-control.html"><span class="header-section-number">12</span> Version Control</a></li>
<li class="book-part">Step 5: Deploy</li>
<li><a class="" href="deploy.html"><span class="header-section-number">13</span> Deploy Your Application</a></li>
<li class="book-part">Optimizing</li>
<li><a class="" href="need-for-optimization.html"><span class="header-section-number">14</span> The Need for Optimization</a></li>
<li><a class="" href="common-app-caveats.html"><span class="header-section-number">15</span> Common Application Caveats</a></li>
<li><a class="" href="optimizing-shiny-code.html"><span class="header-section-number">16</span> Optimizing {shiny} Code</a></li>
<li><a class="" href="using-javascript.html"><span class="header-section-number">17</span> Using JavaScript</a></li>
<li><a class="" href="css.html"><span class="header-section-number">18</span> A Gentle Introduction to CSS</a></li>
<li class="book-part">Appendix</li>
<li><a class="" href="appendix-a---use-case-building-an-app-from-start-to-finish.html">Appendix A - Use Case: Building an App from Start to Finish</a></li>
<li><a class="" href="appendix-b---session-info.html">Appendix B - Session Info</a></li>
<li><a class="" href="references.html">References</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/ThinkR-open/engineering-shiny-book">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="build-app-golem" class="section level1" number="10">
<h1>
<span class="header-section-number">10</span> Building the App with <code>{golem}</code><a class="anchor" aria-label="anchor" href="#build-app-golem"><i class="fas fa-link"></i></a>
</h1>
<p>Now that the application is prototyped inside a <a href="https://github.com/ThinkR-open/golem">golem</a> <span class="citation">(<a href="references.html#ref-R-golem">Fay, Guyader, Rochette, et al. 2023</a>)</span> skeleton, you can work on its integration.
In this step of the workflow, you will be linking the back-end and front-end together, and working on the global engineering of the application:</p>
<ul>
<li>add and organize dependencies</li>
<li>create and include sub-modules if necessary</li>
<li>organize utility functions and link them to the module in which they are used</li>
<li>add testing infrastructure</li>
<li>link to CI/CD services</li>
</ul>
<p>Note that some concepts introduced here will be more extensively explored in the following chapters: the present chapter is a walkthrough of what you will find inside the <code>02_dev</code> scripts.</p>
<div id="add-dependencies" class="section level2" number="10.1">
<h2>
<span class="header-section-number">10.1</span> Add dependencies<a class="anchor" aria-label="anchor" href="#add-dependencies"><i class="fas fa-link"></i></a>
</h2>
<div id="package-dependencies" class="section level3" number="10.1.1">
<h3>
<span class="header-section-number">10.1.1</span> Package dependencies<a class="anchor" aria-label="anchor" href="#package-dependencies"><i class="fas fa-link"></i></a>
</h3>
<p>When you are building a <a href="https://shiny.rstudio.com/">shiny</a> <span class="citation">(<a href="references.html#ref-R-shiny">Chang et al. 2022</a>)</span> application, you will have to deal with dependencies.
Well, at least with one dependency, <a href="https://shiny.rstudio.com/">shiny</a>.
But chances are that you will not only be using <a href="https://shiny.rstudio.com/">shiny</a> inside your application: you will probably call functions from other packages, for example, from <a href="https://ggplot2.tidyverse.org">ggplot2</a> <span class="citation">(<a href="references.html#ref-R-ggplot2">Wickham, Chang, et al. 2023</a>)</span> for plotting, or any other package that is necessary for your application to work.</p>
<p>If you are building your application using <a href="https://github.com/ThinkR-open/golem">golem</a>, you will have 3 default dependencies: <a href="https://github.com/ThinkR-open/golem">golem</a> itself, <a href="https://shiny.rstudio.com/">shiny</a>, and <a href="https://github.com/rstudio/config">config</a>.
If you call <code><a href="https://rdrr.io/pkg/golem/man/use_recommended.html">golem::use_recommended_deps()</a></code> in the first workflow script, you will also have <a href="https://shiny.rstudio.com/">shiny</a>, <a href="https://github.com/rstudio/DT">DT</a>, <a href="https://github.com/ColinFay/attempt">attempt</a>, <a href="https://github.com/tidyverse/glue">glue</a>, <a href="https://github.com/rstudio/htmltools">htmltools</a>, and <a href="https://github.com/ThinkR-open/golem">golem</a> as dependencies to your package.<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content="&lt;p&gt;The idea with this function is to provide a shortcut for adding commonly used dependencies, so that you don’t have to do it by hand.&lt;/p&gt;"><sup>39</sup></a>
But what about other dependencies like <a href="https://ggplot2.tidyverse.org">ggplot2</a>? These ones need to be added by hand.</p>
<p>Here is how to process for a new dependency:</p>
<ul>
<li>Open the <code>dev/02_dev.R</code> script.</li>
<li>Call the <code>use_package()</code> function from <a href="https://usethis.r-lib.org">usethis</a>: <code>usethis::use_package("pkg.you.want.to.add")</code>.</li>
<li>Detail import mechanism in the related R files.</li>
</ul>
</div>
<div id="importing-packages-and-functions" class="section level3" number="10.1.2">
<h3>
<span class="header-section-number">10.1.2</span> Importing packages and functions<a class="anchor" aria-label="anchor" href="#importing-packages-and-functions"><i class="fas fa-link"></i></a>
</h3>
<p>There are two places where the dependencies of your application need to be managed:<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content="&lt;p&gt;This is not &lt;code&gt;{shiny}&lt;/code&gt; or &lt;code&gt;{golem}&lt;/code&gt; specific, but a requirement for any package.&lt;/p&gt;"><sup>40</sup></a> the <code>DESCRIPTION</code> file and the <code>NAMESPACE</code> file.</p>
<ul>
<li><p>The <code>DESCRIPTION</code> file dictates which packages have to be installed <strong>when your application is installed</strong>.
For example, when you install <a href="https://github.com/ThinkR-open/golem">golem</a> on your machine, you will also need other packages that are internally used by <a href="https://github.com/ThinkR-open/golem">golem</a>.
And your application will also have dependencies: at the very least <a href="https://shiny.rstudio.com/">shiny</a>, <a href="https://github.com/ThinkR-open/golem">golem</a>, and <a href="https://github.com/rstudio/config">config</a>.
When building your application, you have to list these requirements somewhere, and the standard way to do that is by using the <code>DESCRIPTION</code> file.<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content="&lt;p&gt;Note that most of the time, you will not be filling this by hand, but by using &lt;code&gt;usethis::use_package()&lt;/code&gt;.&lt;/p&gt;"><sup>41</sup></a></p></li>
<li><p>The <code>NAMESPACE</code> file describes how your app interacts with the R session at run time, i.e. <strong>when your application is launched</strong>.
With this <code>NAMESPACE</code> file, you can specify only a subset of functions to import from other packages: for example, you can choose to import only <code><a href="https://rdrr.io/pkg/DT/man/dataTableOutput.html">renderDT()</a></code> and <code><a href="https://rdrr.io/pkg/DT/man/dataTableOutput.html">DTOutput()</a></code> from <a href="https://github.com/rstudio/DT">DT</a>, instead of importing all the functions.
This selective import mechanism allows you to avoid namespace conflicts: for example, between <code><a href="https://rdrr.io/pkg/jsonlite/man/flatten.html">jsonlite::flatten()</a></code> and <code>purrr::flatten()</code>.<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content="&lt;p&gt;This can be pretty common as &lt;code&gt;{jsonlite}&lt;/code&gt; might import &lt;code&gt;JSON&lt;/code&gt; files as list, and &lt;code&gt;{purrr}&lt;/code&gt; has pretty powerful tools for manipulating lists.&lt;/p&gt;"><sup>42</sup></a>
To do so, we will need to go to every script that defines one or several function/s, and add a <a href="https://roxygen2.r-lib.org/">roxygen2</a> <span class="citation">(<a href="references.html#ref-R-roxygen2">Wickham, Danenberg, et al. 2022</a>)</span> tag, in the following form : <code>#' @importFrom jsonlite fromJSON</code> and <code>#' @importFrom purrr flatten</code>: that way, you are only importing <code>fromJSON()</code> from <a href="https://arxiv.org/abs/1403.2805">jsonlite</a>.</p></li>
</ul>
<p>Note that you can also use explicit namespacing, i.e. the <code>pkg::function()</code> notation inside your code.
And if you need a little help to identify dependencies, all the explicitly namespaced calls (<code>pkg::function()</code>) can be scraped using the <a href="https://thinkr-open.github.io/attachment/">attachment</a> <span class="citation">(<a href="references.html#ref-R-attachment">Rochette and Guyader 2023</a>)</span> package:</p>
<div class="sourceCode" id="cb129"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># This function will read all the scripts in the R/ folder and </span></span>
<span><span class="co"># try to guess required dependencies</span></span>
<span><span class="fu">attachment</span><span class="fu">::</span><span class="fu"><a href="https://thinkr-open.github.io/attachment/reference/att_from_rscripts.html">att_from_rscripts</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>If you are using a development package (for example, one installed from GitHub), you can add it to the <code>DESCRIPTION</code> using the <code>use_dev_package()</code> function from <a href="https://usethis.r-lib.org">usethis</a>.
This will add another field to the <code>DESCRIPTION</code> file, <code>Remotes</code>, with the location where the package is available.</p>
<p>All of this can seem a little bit daunting at first, but that is for the best:</p>
<blockquote>
<p>Having a high quality namespace helps encapsulate your package and makes it self-contained.
This ensures that other packages won’t interfere with your code, that your code won’t interfere with other packages, and that your package works regardless of the environment in which it’s run.</p>
<p><em>R Packages</em> <span class="citation">(<a href="references.html#ref-rpkg">Wickham and Bryan 2020</a>)</span></p>
</blockquote>
<p>To learn more about the details of how to manage dependencies, and about the <code>DESCRIPTION</code> and <code>NAMESPACE</code> files, here are some resources:</p>
<ul>
<li>
<a href="https://cran.r-project.org/manuals.html"><em>Writing R Extensions</em></a>, the official manual from the R-Core team</li>
<li>
<a href="https://r-pkgs.org/">R Packages</a>, especially the <em>Package metadata</em> and <em>Namespace</em> chapters</li>
</ul>
</div>
</div>
<div id="submodules-and-utility-functions" class="section level2" number="10.2">
<h2>
<span class="header-section-number">10.2</span> Submodules and utility functions<a class="anchor" aria-label="anchor" href="#submodules-and-utility-functions"><i class="fas fa-link"></i></a>
</h2>
<p>When building a large application, you <strong>will be splitting your codebase into smaller pieces</strong>.
In Chapter <a href="structuring-project.html#structuring-project">3</a>, “Structuring Your Project”, that these utilitarian functions should be defined in files that are prefixed with a specific term.
In the <a href="https://github.com/ThinkR-open/golem">golem</a> world, these are <code>utils_*</code> and <code>fct_*</code> files:</p>
<ul>
<li>
<code>utils_*</code> files contain small functions that might be used several times in the application.</li>
<li>
<code>fct_*</code> files contain larger functions that are more central to the application.</li>
</ul>
<p>Two functions can be called to create these files:</p>
<div class="sourceCode" id="cb130"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Adding fct_ and utils_ files to the project</span></span>
<span><span class="fu">golem</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/golem/man/file_creation.html">add_fct</a></span><span class="op">(</span> <span class="st">"helpers"</span> <span class="op">)</span> </span>
<span><span class="fu">golem</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/golem/man/file_creation.html">add_utils</a></span><span class="op">(</span> <span class="st">"helpers"</span> <span class="op">)</span></span></code></pre></div>
<ul>
<li>The first will create a <code>R/fct_helpers.R</code> file.</li>
<li>The second will create a <code>R/utils_helpers.R</code> file.</li>
</ul>
<p>The idea, as explained before, is that as soon as you open a <a href="https://github.com/ThinkR-open/golem">golem</a>-based project, you are able to identify what the files contain, without having to open them.<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content="&lt;p&gt;The &lt;code&gt;utils_*&lt;/code&gt; convention is a pretty common one: a lot of R packages contain a file called &lt;code&gt;utils.R&lt;/code&gt; that bundles a series of small functions that are used throughout the package.&lt;/p&gt;"><sup>43</sup></a></p>
<p>For example, the <a href="https://github.com/colinfay/hexmake">hexmake</a> app has two of these files, <a href="https://github.com/ColinFay/hexmake/blob/master/R/utils_ui.R"><code>R/utils_ui.R</code></a> and <a href="https://github.com/ColinFay/hexmake/blob/master/R/utils_server.R"><code>R/utils_server.R</code></a>, in which you will find small functions that are reused throughout the app.</p>
<p>The <code>fct_*</code> files are to be used with larger functions, which are more central to the application, but that might not fit into a specific module.
For example, in <a href="https://github.com/colinfay/hexmake">hexmake</a>, you will find <a href="https://github.com/ColinFay/hexmake/blob/master/R/fct_mongo.R"><code>R/fct_mongo.R</code></a>, which is used to handle all the things related to connecting and interacting with the Mongodb database.</p>
<p>As you can see, the difference is that <code>fct_*</code> file are more “topic centered”, in the sense that they gather functions that relate to a specific feature of the application (here, the database), while <code>utils_*</code> files are more used as a place to put miscellaneous functions.</p>
<p>Note that when building a module with <code><a href="https://rdrr.io/pkg/golem/man/add_module.html">golem::add_module()</a></code>, you can add a module-specific <code>fct_*</code> or <code>utils_*</code> file:</p>
<div class="sourceCode" id="cb131"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Creating the fct_ and utils_ file along the module creation</span></span>
<span><span class="fu">golem</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/golem/man/add_module.html">add_module</a></span><span class="op">(</span></span>
<span>    name <span class="op">=</span> <span class="st">"rendering"</span>, </span>
<span>    fct <span class="op">=</span> <span class="st">"connect"</span>, </span>
<span>    utils <span class="op">=</span> <span class="st">"wrapper"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Will create:</p>
<ul>
<li><code>R/mod_rendering.R</code></li>
<li><code>R/mod_rendering_fct_connect.R</code></li>
<li><code>R/mod_rendering_utils_wrapper.R</code></li>
</ul>
<p>And this can also be done the other way around, by specifying the module you want to link your file to:</p>
<div class="sourceCode" id="cb132"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Linking the utils_wrapper file to the rendering module</span></span>
<span><span class="fu">golem</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/golem/man/file_creation.html">add_utils</a></span><span class="op">(</span><span class="st">"wrapper"</span>, module <span class="op">=</span> <span class="st">"rendering"</span><span class="op">)</span></span></code></pre></div>
</div>
<div id="add-tests" class="section level2" number="10.3">
<h2>
<span class="header-section-number">10.3</span> Add tests<a class="anchor" aria-label="anchor" href="#add-tests"><i class="fas fa-link"></i></a>
</h2>
<p>No piece of software should go into production if it has not been sufficiently tested.
In this part of the building process, you will be setting tests for the application you are building.
We will get back to the how, why and what of testing in an upcoming chapter, but as we are currently going through the <code>02_dev.R</code> script, we mention here the line that allows you to add a test skeleton to your app.</p>
<p>If you have followed every step from the <code>01_start.R</code> file, you already have a full testing infrastructure ready, with a set of recommended tests inserted by <a href="https://github.com/ThinkR-open/golem">golem</a>.
But as it is hard to find tests that are relevant to all applications (as every application is unique), you will have to add and manually fill the tests that will check your app.
And right now, to add a new testing file, you can call:</p>
<div class="sourceCode" id="cb133"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Generate the testing infrastructure</span></span>
<span><span class="fu">usethis</span><span class="fu">::</span><span class="fu"><a href="https://usethis.r-lib.org/reference/use_r.html">use_test</a></span><span class="op">(</span><span class="st">"app"</span><span class="op">)</span></span></code></pre></div>
<p>More on testing in Chapter <a href="build-yourself-safety-net.html#build-yourself-safety-net">11</a>.</p>
</div>
<div id="documentation-and-code-coverage" class="section level2" number="10.4">
<h2>
<span class="header-section-number">10.4</span> Documentation and code coverage<a class="anchor" aria-label="anchor" href="#documentation-and-code-coverage"><i class="fas fa-link"></i></a>
</h2>
<div id="vignette" class="section level3" number="10.4.1">
<h3>
<span class="header-section-number">10.4.1</span> Vignette<a class="anchor" aria-label="anchor" href="#vignette"><i class="fas fa-link"></i></a>
</h3>
<p>Vignettes are the long-format documentation for your application: users see this documentation when they are running <code><a href="https://rdrr.io/r/utils/browseVignettes.html">browseVignettes()</a></code>, when they look at the documentation in the <code>Help</code> pane from RStudio, or when they are browsing a web page on CRAN, and they are also the files that are used when the <a href="https://pkgdown.r-lib.org">pkgdown</a> websites are built.
The good news is that if you have been using our “Rmd first” method, you already have most of the Vignettes built: they are the Markdown files describing how the back-end of your application works.
Depending on how you applied this principle, these Rmd files might live inside the <code>inst/</code> folder, or already as package Vignettes.
If you need to add a new Vignette, be it for adding an Rmd describing the back-end or a global documentation about the application, you can call the <code>use_vignette()</code> function from <a href="https://usethis.r-lib.org">usethis</a>.</p>
<div class="sourceCode" id="cb134"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Adding a new Vignette named "shinyexample"</span></span>
<span><span class="fu">usethis</span><span class="fu">::</span><span class="fu"><a href="https://usethis.r-lib.org/reference/use_vignette.html">use_vignette</a></span><span class="op">(</span><span class="st">"shinyexample"</span><span class="op">)</span></span></code></pre></div>
<p>Then, you can build all the Vignettes with:</p>
<div class="sourceCode" id="cb135"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Compiling the Vignettes</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://devtools.r-lib.org/reference/build_vignettes.html">build_vignettes</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div id="code-coverage-and-continuous-integration" class="section level3" number="10.4.2">
<h3>
<span class="header-section-number">10.4.2</span> Code coverage and continuous integration<a class="anchor" aria-label="anchor" href="#code-coverage-and-continuous-integration"><i class="fas fa-link"></i></a>
</h3>
<div id="a.-code-coverage" class="section level4 unnumbered">
<h4>A. Code coverage<a class="anchor" aria-label="anchor" href="#a.-code-coverage"><i class="fas fa-link"></i></a>
</h4>
<p>Code coverage is a way to detect the volume of code that is covered by unit testing.
You can do this locally, or you can use online services like Appveyor, an online platform that computes and tracks the code coverage of your repository.</p>
<p>To add it to your application, call the <code>use_coverage()</code> function from the <a href="https://usethis.r-lib.org">usethis</a> package:</p>
<div class="sourceCode" id="cb136"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Adding the correct code coverage </span></span>
<span><span class="co"># infrastructure in your application</span></span>
<span><span class="fu">usethis</span><span class="fu">::</span><span class="fu"><a href="https://usethis.r-lib.org/reference/use_coverage.html">use_coverage</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>At the time of writing these lines, this function supports two services: <a href="https://codecov.io/">CodeCov</a> and <a href="https://coveralls.io/">coveralls</a>.</p>
<p>Note that you can also perform code coverage locally, using the <a href="https://covr.r-lib.org">covr</a> <span class="citation">(<a href="references.html#ref-R-covr">Hester 2023</a>)</span> package, and the <code>package_coverage()</code> function.</p>
<div class="sourceCode" id="cb137"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Compute the code coverage of your application</span></span>
<span><span class="va">code_coverage</span> <span class="op">&lt;-</span> <span class="fu">covr</span><span class="fu">::</span><span class="fu"><a href="http://covr.r-lib.org/reference/package_coverage.html">package_coverage</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>For example, Figure <a href="build-app-golem.html#fig:10-step-by-step-build-11">10.1</a> is the output of running the <code>package_coverage()</code> function on the <a href="https://github.com/ThinkR-open/golem">golem</a> package on the 2020-04-29 on the <code>dev</code> branch:</p>

<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:10-step-by-step-build-11"></span>
<img src="img/golemcov.png" alt="{golem} code coverage results." width="100%"><p class="caption">
FIGURE 10.1: {golem} code coverage results.
</p>
</div>
<p>As you can see, we reach a code coverage of almost 70%.
<strong>Deciding what the perfect percentage of coverage should be is not an easy task, and setting for an arbitrary coverage is not a smart move either, as it very much depends on the type of project you are working on</strong>.
For example, in <a href="https://github.com/ThinkR-open/golem">golem</a>, the <code>addins.R</code> file is not tested (0% code coverage), and that is for a good reason: these addins are linked to RStudio and are not meant to be tested/used in a non-interactive environment, and (at least at the time of writing these lines) there is no automated way to test for RStudio addins.
Another thing to keep in mind while computing code coverage is that it counts the number of lines that are run when the tests are run, which means that if you write your whole function on one single line, you will have 100% code coverage.
Another example is writing your <code>if/else</code> statement on one line <code>if (this) that else that</code>: your code coverage will count this line as covered, even if your test suite only runs the <code>if(this)</code> and not the <code>else</code>; in other words, even if your code coverage is good here, you are still not testing this algorithm extensively.</p>
<p>Note that you can also identify files with zero code coverage using the <code>covr::zero_coverage(covr::package_coverage())</code> function, which, instead of printing back a metric of coverage for each file, will point to all the lines that are not covered by tests inside your package, as shown in Figure <a href="build-app-golem.html#fig:10-step-by-step-build-12">10.2</a>.</p>

<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:10-step-by-step-build-12"></span>
<img src="img/zerocov.png" alt="{golem} files with zero code coverage." width="100%"><p class="caption">
FIGURE 10.2: {golem} files with zero code coverage.
</p>
</div>
<p>To sum up: do not set an arbitrary code coverage percentage goal, but rather use it as a general metric throughout your project.
With CodeCov, you can get a timeline of the evolution of code coverage: a good tool for judging when you need to write more tests.
For example, Figure <a href="build-app-golem.html#fig:10-step-by-step-build-13">10.3</a> is the general tendency for the code coverage of the <a href="https://tibble.tidyverse.org/">tibble</a> package over the last 6 months (November 2019 to April 2020):</p>

<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:10-step-by-step-build-13"></span>
<img src="img/codecov-tibble.png" alt="CodeCov.io results for the {tibble} package." width="100%"><p class="caption">
FIGURE 10.3: CodeCov.io results for the {tibble} package.
</p>
</div>
<p>Perfect for getting a general feeling about the code coverage during the life of the project!</p>
<p>Note also that if you want to add the code coverage of your application inside a Vignette, you can use the <a href="https://github.com/yonicd/covrpage">covrpage</a> <span class="citation">(<a href="references.html#ref-R-covrpage">Sidi 2023</a>)</span> package, which bundles the results of the <a href="https://covr.r-lib.org">covr</a> coverage report into an interactive, human-readable Vignette that you can use later on as package documentation, or as an article inside your package website.
<a href="https://github.com/yonicd/covrpage">covrpage</a> can be installed from GitHub with <code>remotes::install_github('yonicd/covrpage')</code>.</p>
</div>
<div id="b.-continuous-integration" class="section level4 unnumbered">
<h4>B. Continuous Integration<a class="anchor" aria-label="anchor" href="#b.-continuous-integration"><i class="fas fa-link"></i></a>
</h4>
<p>Continuous integration, on the other hand, is ensuring the software is still working whenever a change is made by one of the developers.
The idea is to add to the centralized version control system (for example, Git)<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;We will get back to version control in the Chapter &lt;a href="version-control.html#version-control"&gt;12&lt;/a&gt;, “Version Control”..&lt;/p&gt;'><sup>44</sup></a> a service like Travis CI, GitHub Action (if you are on GitHub), or GitLab CI (for GitLab) that runs a series of commands whenever something is integrated in the repository, i.e. every time a change to the codebase is made.
In other words, every time a new piece of code is sent to the central repository, a service runs regression tests that check that the software is still in a valid, working state.</p>
<p>You can set up various continuous integration services automatically by using functions from the <a href="https://usethis.r-lib.org">usethis</a> package:</p>
<ul>
<li>Travis CI is set up with <code><a href="https://usethis.r-lib.org/reference/ci.html">usethis::use_travis()</a></code>.</li>
<li>AppVeyor with <code><a href="https://usethis.r-lib.org/reference/ci.html">usethis::use_appveyor()</a></code>.</li>
<li>GitLab CI with <code>use_gitlab_ci()</code>.</li>
<li>Circle CI with <code>use_circleci()</code>.</li>
<li>GitHub Actions with <code>use_github_actions()</code>.</li>
<li>Jenkins with <code>use_jenkins()</code>.</li>
</ul>
<p>If ever you want to add badges to your <code>README</code> files for these services, <a href="https://usethis.r-lib.org">usethis</a> also comes with a series of functions to do just that: <code>use_travis_badge()</code>, <code>use_appveyor_badge()</code>, <code>use_circleci_badge()</code> and <code>use_github_actions_badge()</code>.</p>
<p>CI services can do a lot more, like for example, deploy the application, build a container and send it to a container registry, compile RMarkdown files, etc.<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content="&lt;p&gt;For example, the online version of this book is compiled to HTML every time something is merged into the &lt;code&gt;master&lt;/code&gt; branch on GitHub.&lt;/p&gt;"><sup>45</sup></a>
The possibilities are almost limitless!</p>
</div>
</div>
</div>
<div id="using-golem-dev-functions" class="section level2" number="10.5">
<h2>
<span class="header-section-number">10.5</span> Using <code>{golem}</code> dev functions<a class="anchor" aria-label="anchor" href="#using-golem-dev-functions"><i class="fas fa-link"></i></a>
</h2>
<p>When building an application, you will want it to behave differently depending on where it is run, and notably, if it is run in development or in production.
We have seen in previous chapters that you can use the <code>golem-config.yml</code> file, or pass arguments to <code>run_app()</code>.
A third option is to use the <code>dev</code> functions from <a href="https://github.com/ThinkR-open/golem">golem</a>.</p>
<p>There is a series of tools to make your app behave differently whether it is in “dev” or “prod” mode.
Notably, the <code>app_prod()</code> and <code>app_dev()</code> functions look for the value of <code>options( "golem.app.prod" )</code>, or return <code>TRUE</code> if this option does not exist.
In other words, by setting <code>options( "golem.app.prod" )</code> to <code>TRUE</code>, you will make the functions that depend on this option behave in a specific way.</p>
<p>Some functions pre-exist in <a href="https://github.com/ThinkR-open/golem">golem</a>, for example if you need to print a message to the console only during dev, you can do it with <code>cat_dev()</code>.</p>
<div class="sourceCode" id="cb138"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Setting the option to FALSE</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/options.html">options</a></span><span class="op">(</span> <span class="st">"golem.app.prod"</span> <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co"># Function runs as expected</span></span>
<span><span class="fu">golem</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/golem/man/made_dev.html">cat_dev</a></span><span class="op">(</span><span class="st">"In dev\n"</span><span class="op">)</span></span></code></pre></div>
<pre><code>In dev</code></pre>
<div class="sourceCode" id="cb140"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Switching the option to TRUE</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/options.html">options</a></span><span class="op">(</span> <span class="st">"golem.app.prod"</span> <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co"># Nothing is printing</span></span>
<span><span class="fu">golem</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/golem/man/made_dev.html">cat_dev</a></span><span class="op">(</span><span class="st">"In dev\n"</span><span class="op">)</span></span></code></pre></div>
<p>Of course, chances are you do not only need to print things, you might want to use other functions.
Good news!
You can make any function being “dev-dependent” with the <code>make_dev()</code> function:</p>
<div class="sourceCode" id="cb141"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Same mechanism as cat_dev, but with other functions </span></span>
<span><span class="va">log_dev</span> <span class="op">&lt;-</span> <span class="fu">golem</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/golem/man/make_dev.html">make_dev</a></span><span class="op">(</span><span class="va">log</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/options.html">options</a></span><span class="op">(</span> <span class="st">"golem.app.prod"</span> <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu">log_dev</span><span class="op">(</span><span class="fl">10</span><span class="op">)</span></span></code></pre></div>
<pre><code>[1] 2.303</code></pre>
<div class="sourceCode" id="cb143"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/options.html">options</a></span><span class="op">(</span> <span class="st">"golem.app.prod"</span> <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu">log_dev</span><span class="op">(</span><span class="fl">10</span><span class="op">)</span></span></code></pre></div>
<p>That way, you can use functions in your back-end for development purposes, that will be ignored in production.</p>

</div>
</div>




<hr>
<footer><a href="https://rtask.thinkr.fr"><img src="img/logo400_129.png" alt="ThinkR Website"></a>
<!--https://yihui.org/en/2018/09/target-blank/-->
<script>
  (function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
</script></footer><div class="chapter-nav">
<div class="prev"><a href="building-ispum-app.html"><span class="header-section-number">9</span> Building an “ipsum-app”</a></div>
<div class="next"><a href="build-yourself-safety-net.html"><span class="header-section-number">11</span> Build Yourself a Safety Net</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#build-app-golem"><span class="header-section-number">10</span> Building the App with {golem}</a></li>
<li>
<a class="nav-link" href="#add-dependencies"><span class="header-section-number">10.1</span> Add dependencies</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#package-dependencies"><span class="header-section-number">10.1.1</span> Package dependencies</a></li>
<li><a class="nav-link" href="#importing-packages-and-functions"><span class="header-section-number">10.1.2</span> Importing packages and functions</a></li>
</ul>
</li>
<li><a class="nav-link" href="#submodules-and-utility-functions"><span class="header-section-number">10.2</span> Submodules and utility functions</a></li>
<li><a class="nav-link" href="#add-tests"><span class="header-section-number">10.3</span> Add tests</a></li>
<li>
<a class="nav-link" href="#documentation-and-code-coverage"><span class="header-section-number">10.4</span> Documentation and code coverage</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#vignette"><span class="header-section-number">10.4.1</span> Vignette</a></li>
<li><a class="nav-link" href="#code-coverage-and-continuous-integration"><span class="header-section-number">10.4.2</span> Code coverage and continuous integration</a></li>
</ul>
</li>
<li><a class="nav-link" href="#using-golem-dev-functions"><span class="header-section-number">10.5</span> Using {golem} dev functions</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/ThinkR-open/engineering-shiny-book/blob/master/10-step-by-step-build.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/ThinkR-open/engineering-shiny-book/edit/master/10-step-by-step-build.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Engineering Production-Grade Shiny Apps</strong>" was written by Colin Fay, Sébastien Rochette, Vincent Guyader, Cervan Girard. It was last built on 2024-03-12.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
